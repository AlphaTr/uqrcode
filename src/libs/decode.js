"use strict";function QRDecode(){this.image=null,this.imageTop=0,this.imageBottom=0,this.imageLeft=0,this.imageRight=0,this.nModules=0,this.moduleSize=0,this.version=0,this.functionalGrade=0,this.ECLevel=0,this.mask=0,this.maskPattern=[],this.nBlockEcWords=0,this.blockIndices=[],this.blockDataLengths=[]}QRDecode.prototype={decodePix:function(e){return this.decodeImage(e)},decodeImageData:function(e,t,n){return this.setImageData(e,t,n),this.decode()},decodeImageDataInsideBordersWithMaxVersion:function(e,t,n,r,i,s,o,u){return this.setImageData(e,t,n),this.imageLeft=r,this.imageRight=i,this.imageTop=s,this.imageBottom=o,this.imageSize=(this.imageRight-this.imageLeft+1+(this.imageBottom-this.imageTop+1))/2,this.maxVersion=u,this.decodeInsideBordersWithMaxVersion()},setImageData:function(e,t,n){var r,i,s,o,u;e.minCol=255,e.maxCol=0;r=0;for(i=0;i<t;i++)for(s=0;s<n;s++)o=i*4+s*t*4,u=.3*e.data[o]+.59*e.data[o+1]+.11*e.data[o+2],r+=u,u<e.minCol&&(e.minCol=u),u>e.maxCol&&(e.maxCol=u);if(e.maxCol-e.minCol<25.5)throw"Image does not have enough contrast (this.image_data.min_col="+e.minCol+" this.image_data.max_col="+e.maxCol+")";e.threshold=r/(t*n),e.getGray=function(e,t,n){var i,s,o,r=0;for(i=e;i<e+n;i++)for(s=t;s<t+n;s++)o=i*4+s*this.width*4,r=r+.3*this.data[o]+.59*this.data[o+1]+.11*this.data[o+2];return r/n/n},e.isDark=function(e,t,n){var r=this.getGray(e,t,n);return r<this.threshold},this.image=e},decodeImage:function(e){return this.image=e,this.decode()},decode:function(){return this.findImageBorders(),this.maxVersion=40,this.decodeInsideBordersWithMaxVersion(),this.data},decodeInsideBordersWithMaxVersion:function(){return this.findModuleSize(),QRBase.setFunctionalPattern(this),this.extractCodewords(),QRBase.setBlocks(this),this.correctErrors(),this.extractData(),this.data},findImageBorders:function(){var e,t,n,r=7,i=2;for(e=0;e<this.image.width;e++){n=0;for(t=0;t<this.image.height;t++)n+=this.image.isDark(e,t,1);if(n>=r)break}this.imageLeft=e;for(e=this.image.width-1;e>=0;e--){n=0;for(t=0;t<this.image.height;t++)n+=this.image.isDark(e,t,1);if(n>=r)break}this.imageRight=e;for(t=0;t<this.image.height;t++){n=0;for(e=0;e<this.image.width;e++)n+=this.image.isDark(e,t,1);if(n>=r)break}this.imageTop=t;for(t=this.image.height-1;t>=0;t--){n=0;for(e=0;e<this.image.width;e++)n+=this.image.isDark(e,t,1);if(n>=r)break}this.imageBottom=t;if(this.imageRight-this.imageLeft+1<21||this.imageBottom-this.imageTop+1<21)throw"Found no image data to decode";if(Math.abs(this.imageRight-this.imageLeft-(this.imageBottom-this.imageTop))>i)throw"Image data is not rectangular";this.imageSize=(this.imageRight-this.imageLeft+1+(this.imageBottom-this.imageTop+1))/2},findModuleSize:function(){var d,v,m;function e(e,t,n,r,i,s){var o,u,a=0;for(o=0;o<=5;o++)e.isDarkWithSize(t+o,n,s)&&(a+=1),e.isDarkWithSize(t+6,n+o,s)&&(a+=1),e.isDarkWithSize(t+6-o,n+6,s)&&(a+=1),e.isDarkWithSize(t,n+6-o,s)&&(a+=1);for(o=0;o<=3;o++)e.isDarkWithSize(t+o+1,n+1,s)||(a+=1),e.isDarkWithSize(t+5,n+o+1,s)||(a+=1),e.isDarkWithSize(t+5-o,n+5,s)||(a+=1),e.isDarkWithSize(t+1,n+5-o,s)||(a+=1);for(o=0;o<=2;o++)for(u=0;u<=2;u++)e.isDarkWithSize(3+t,3+n,s)&&(a+=1);for(o=0;o<=6;o++)e.isDarkWithSize(t+r,n+o,s)||(a+=1),e.isDarkWithSize(t+o,n+i,s)||(a+=1);return e.isDarkWithSize(t+r,n+i,s)||(a+=1),a}function t(e,t,n,r){var c,p,d,v,m,i=0,s=6,o=8,u=0,a=1,f=5,l=[],h=!0;t&&(s=8,o=6,u=1,a=0);for(c=0;c<f;c++)l.push(1);for(p=0;p<n-8-8;p++){d=s+p*u,v=o+p*a,h===e.isDarkWithSize(d,v,r)?(i++,l.push(1)):l.push(0),h=!h,m=0;for(c=l.length-f;c<l.length-1;c++)l[c]&&(m+=1);if(m<3)return 0}return i}function n(e,t,n,r){var s,i=0;for(s=0;s<=3;s++)e.isDarkWithSize(t+s,n,r)&&(i+=1),e.isDarkWithSize(t+4,n+s,r)&&(i+=1),e.isDarkWithSize(t+4-s,n+4,r)&&(i+=1),e.isDarkWithSize(t,n+4-s,r)&&(i+=1);for(s=0;s<=1;s++)e.isDarkWithSize(t+s+1,n+1,r)||(i+=1),e.isDarkWithSize(t+3,n+s+1,r)||(i+=1),e.isDarkWithSize(t+3-s,n+3,r)||(i+=1),e.isDarkWithSize(t+1,n+3-s,r)||(i+=1);return e.isDarkWithSize(t+2,n+2,r)&&(i+=1),i}function r(e,t,r){var o,u,a,i=0,s=QRBase.alignmentPatterns[t].length;for(o=0;o<s;o++)for(u=0;u<s;u++){if(o===0&&u===0||o===0&&u===s-1||o===s-1&&u===0)continue;a=n(e,QRBase.alignmentPatterns[t][o]-2,QRBase.alignmentPatterns[t][u]-2,r),a>24&&i++}return i}function i(e,t){var n,r;for(n=7;n<=40;n++){r=e.hammingDistance(t,QRBase.versionInfo[n]);if(r<=3)return[n,r]}return[0,4]}function s(e,t,n){var o,u,r=1,s=0;for(u=0;u<6;u++)for(o=t-11;o<t-11+3;o++)e.isDarkWithSize(o,u,n)&&(s+=r),r*=2;return i(e,s)}function o(e,t,n){var o,u,r=1,s=0;for(o=0;o<6;o++)for(u=t-11;u<t-11+3;u++)e.isDarkWithSize(o,u,n)&&(s+=r),r*=2;return i(e,s)}function u(e,t){var n,r;for(n=0;n<32;n++){r=e.hammingDistance(t,QRBase.formatInfo[n]);if(r<=3)return[n,r]}return[0,4]}function a(e,t,n){var o,r=1,i=0,s=8;for(o=0;o<=5;o++)e.isDarkWithSize(s,o,n)&&(i+=r),r*=2;e.isDarkWithSize(8,7,n)&&(i+=r),r*=2,e.isDarkWithSize(8,8,n)&&(i+=r),r*=2,e.isDarkWithSize(7,8,n)&&(i+=r),r*=2,o=8;for(s=5;s>=0;s--)e.isDarkWithSize(s,o,n)&&(i+=r),r*=2;return u(e,i)}function f(e,t,n){var s,r=1,i=0,o=8;for(s=t-1;s>t-1-8;s--)e.isDarkWithSize(s,o,n)&&(i+=r),r*=2;s=8;for(o=t-7;o<t-1;o++)e.isDarkWithSize(s,o,n)&&(i+=r),r*=2;return u(e,i)}function l(e){var n,t=4;for(n=0;n<3;n++)t-=64-e[n];return t<0&&(t=0),t}function c(e,t){var n=(e[0]+e[1])/(2*t);return n=1-n,n>=.14?0:n>=.11?1:n>=.07?2:n>=1e-5?3:4}function h(e,t){var n=e/t;return n=1-n,n>=.3?0:n>=.2?1:n>=.1?2:n>=1e-5?3:4}function p(n,i){var u,S,x,T,N,C,L,p=[],d=QRBase.nModulesFromVersion(i),v=n.imageSize/d,m=[0,0,0],g=[0,0],y=[0,0],b=[0,0],w=-3,E=0,k=4;m[0]=e(n,0,0,7,7,v);if(m[0]<61)return[i,0];m[1]=e(n,0,d-7,7,-1,v);if(m[0]+m[1]<125)return[i,0];m[2]=e(n,d-7,0,-1,7,v),u=l(m);if(u<1)return[i,0];p.push(u);if(i>=7){g=s(n,d,v),y=o(n,d,v),S=i,g[1]<y[1]?g[1]<4&&(S=g[0]):y[1]<4&&(S=y[0]),S!==i&&(i=S),d=QRBase.nModulesFromVersion(i),v=n.imageSize/d,u=Math.round((4-g[1]+(4-y[1]))/2);if(u<1)return[i,0];p.push(u)}b[0]=t(n,!0,d,v),b[1]=t(n,!1,d,v),u=c(b,d-8-8);if(u<1)return[i,0];p.push(u),i>1&&(w=r(n,i,v)),u=h(w,QRBase.alignmentPatterns[i].length*QRBase.alignmentPatterns[i].length-3);if(u<1)return[i,0];p.push(u),x=a(n,d,v),T=f(n,d,v),x[1]<T[1]?E=x[0]:E=T[0],N=Math.floor(E/8),C=E%8,u=Math.round((4-x[1]+(4-T[1]))/2);if(u<1)return[i,0];p.push(u);for(L=0;L<p.length;L++)p[L]<k&&(k=p[L]);return[i,k,N,C]}d=[0,0];for(v=1;v<=this.maxVersion;v++){m=p(this,v),m[1]>d[1]&&(d=m);if(m[1]===4)break}this.version=d[0],this.nModules=QRBase.nModulesFromVersion(this.version),this.moduleSize=this.imageSize/this.nModules,this.functionalGrade=d[1],this.ECLevel=d[2],this.mask=d[3];if(this.functionalGrade<1)throw"Unable to decode a function pattern"},extractCodewords:function(){var t,n,r,i,s,o,u,a;function e(e,t,n){var r,i;switch(e.mask){case 0:r=(n+t)%2;break;case 1:r=n%2;break;case 2:r=t%3;break;case 3:r=(n+t)%3;break;case 4:r=(Math.floor(n/2)+Math.floor(t/3))%2;break;case 5:r=n*t%2+n*t%3;break;case 6:r=(n*t%2+n*t%3)%2;break;case 7:r=((n+t)%2+n*t%3)%2}return r===0?i=!e.isDark(t,n):i=e.isDark(t,n),i}this.codewords=[];t=!0,n=0,r=128,i=0;for(o=this.nModules-1;o>0;o-=2){o===6&&o--;for(a=0;a<this.nModules;a++){s=t?this.nModules-1-a:a;for(u=0;u<2;u++)this.functionalPattern[o-u][s]||(e(this,o-u,s)&&(n+=r),r/=2,r<1&&(this.codewords.push(n),i=0,r=128,n=0))}t^=!0}},extractData:function(){var i,s,o,u;function e(e,t,n,r){var i=24-(n&7)-r,s=(1<<r)-1,o=n>>>3;return(t[o]<<16|t[++o]<<8|t[++o])>>i&s}function t(t,n){var o,u,r=QRBase.nCountBits(QRBase.MODE.EightBit,t.version),i=e(t,n,t.bitIdx,r),s="";t.bitIdx+=r;for(o=0;o<i;o++)u=e(t,n,t.bitIdx,8),s+=String.fromCharCode(u),t.bitIdx+=8;return QRBase.utf8Tounicode(s)}function n(t,n){var o,u,r=QRBase.nCountBits(QRBase.MODE.AlphaNumeric,t.version),i=e(t,n,t.bitIdx,r),s="";t.bitIdx+=r;for(o=0;o<Math.floor(i/2);o++)u=e(t,n,t.bitIdx,11),s+=t.alphanum[Math.floor(u/45)],s+=t.alphanum[u%45],t.bitIdx+=11;return i%2&&(s+=t.alphanum[e(t,n,t.bitIdx,6)],t.bitIdx+=6),s}function r(t,n){var o,u,a,f,l,r=QRBase.nCountBits(QRBase.MODE.Numeric,t.version),i=e(t,n,t.bitIdx,r),s="";t.bitIdx+=r;for(l=0;l<Math.floor(i/3);l++)o=e(t,n,t.bitIdx,10),t.bitIdx+=10,u=Math.floor(o/100),a=Math.floor(o%100/10),f=o%10,s+=String.fromCharCode(48+u,48+a,48+f);return i%3===1?(o=e(t,n,t.bitIdx,4),t.bitIdx+=4,s+=String.fromCharCode(48+o)):i%3===2&&(o=e(t,n,t.bitIdx,7),t.bitIdx+=7,u=Math.floor(o/10),a=o%10,s+=String.fromCharCode(48+u,48+a)),s}i=this.bytes,s=i.length*8;for(o=0;o<4;o++)i.push(0);this.data="",this.bitIdx=0;while(this.bitIdx<s-4){u=e(this,i,this.bitIdx,4),this.bitIdx+=4;if(u===QRBase.MODE.Terminator)break;if(u===QRBase.MODE.AlphaNumeric)this.data+=n(this,i);else if(u===QRBase.MODE.EightBit)this.data+=t(this,i);else{if(u!==QRBase.MODE.Numeric)throw"Unsupported ECI mode: "+u;this.data+=r(this,i)}}},correctErrors:function(){var r,i,s,o,e=new ReedSolomon(this.nBlockEcWords),t=[],n=[];for(r=0;r<this.blockIndices.length;r++){i=[];for(o=0;o<this.blockIndices[r].length;o++)i.push(this.codewords[this.blockIndices[r][o]]);s=e.decode(i);if(!e.corrected)throw this.errorGrade=0,"Unable to correct errors ("+e.uncorrected_reason+")";n=n.concat(s),t.push(e.n_errors)}this.errors=t,this.bytes=n,this.errorGrade=this.gradeErrors(t)},gradeErrors:function(e){var i,t=this.nBlockEcWords,n=0,r=4;for(i=0;i<e.length;i++)e[i]>n&&(n=e[i]);return n>t/2-1?r=0:n>t/2-2?r=1:n>t/2-3?r=2:n>t/2-4&&(r=3),r},hammingDistance:function(e,t){var r;function n(e){var t;for(t=0;e;t++)e&=e-1;return t}r=e^t;return n(r)},isDarkWithSize:function(e,t,n){return this.image.isDark(Math.round(this.imageLeft+e*n),Math.round(this.imageTop+t*n),Math.round(n))},isDark:function(e,t){return this.isDarkWithSize(e,t,this.moduleSize)},alphanum:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"]},"use strict",function(e){var i=function(t){var n=this,r;n.text="",e.extend(n,{_init:function(e){var t=new QRDecode,r=t.decodeImageData(e,n.width,n.height);return r},getImageData:function(t){var r;if(t.nodeName.toLowerCase()!=="canvas"){if(!e(t).find("canvas").length)return!1;t=e(t).find("canvas")[0]}return r=t.getContext("2d"),n.width=t.width,n.height=t.height,r.getImageData(0,0,t.width,t.height)}}),r=n.getImageData(t),r&&(n.text=n._init(r))};e.fn.qrdecode=function(){var t=e(this),n=t.length,r="";return n&&(r=(new i(t[0])).text),r}}(jQuery,window,document)